<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copy Button Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Outfit:wght@600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom Font Settings */
        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3, button { font-family: 'Outfit', sans-serif; }

        /* Animated Gradient Background */
        .animated-bg {
            background: linear-gradient(-45deg, #0f172a, #1e1b4b, #312e81, #0f172a);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Custom Scrollbar for Textarea */
        textarea::-webkit-scrollbar {
            width: 10px;
        }
        textarea::-webkit-scrollbar-track {
            background: #1e293b; 
            border-radius: 8px;
        }
        textarea::-webkit-scrollbar-thumb {
            background: #475569; 
            border-radius: 8px;
        }
        textarea::-webkit-scrollbar-thumb:hover {
            background: #64748b; 
        }

        /* Staggered Entry Animation Classes */
        .fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glass-input {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
    </style>
</head>
<body class="animated-bg text-gray-200 flex items-center justify-center min-h-screen p-4 sm:p-8">

    <div class="w-full max-w-5xl mx-auto relative z-10">
        
        <!-- Main Glass Card -->
        <div class="glass-panel shadow-[0_0_40px_rgba(0,0,0,0.5)] rounded-3xl p-6 sm:p-10 transition-all duration-500 hover:shadow-[0_0_60px_rgba(79,70,229,0.15)]">
            
            <!-- Header Section -->
            <div class="text-center mb-10">
                <h1 class="text-4xl sm:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-indigo-400 drop-shadow-sm mb-3">
                    Copy Generator
                </h1>
                <p class="text-gray-400 text-lg">Transform standard text into interactive copy-paste blocks.</p>
            </div>

            <!-- Input Section -->
            <div class="mb-8 relative group">
                <div class="absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-indigo-500 rounded-xl opacity-30 group-hover:opacity-70 transition duration-500 blur"></div>
                <div class="relative">
                    <label for="inputText" class="absolute top-4 left-4 text-xs font-bold text-indigo-400 uppercase tracking-wider bg-slate-900/80 px-2 py-1 rounded">Input</label>
                    <textarea id="inputText" rows="10" class="glass-input w-full rounded-xl p-6 pt-12 text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-transparent transition-all duration-300 font-mono text-sm leading-relaxed resize-y" placeholder="Paste your content here..."></textarea>
                </div>
            </div>

            <!-- Action Button -->
            <div class="text-center mb-12">
                <button id="generateBtn" class="relative inline-flex items-center justify-center px-8 py-4 text-lg font-bold text-white transition-all duration-200 bg-indigo-600 rounded-full sm:w-auto hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 shadow-lg hover:shadow-indigo-500/50 hover:-translate-y-1 active:translate-y-0 overflow-hidden group">
                    <span class="absolute inset-0 w-full h-full -mt-1 rounded-lg opacity-30 bg-gradient-to-b from-transparent via-transparent to-black"></span>
                    <span class="relative flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 group-hover:rotate-12 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
                        </svg>
                        Process Content
                    </span>
                </button>
            </div>

            <!-- Output Section -->
            <div id="resultSection" class="opacity-50 transition-opacity duration-500">
                <h2 class="text-2xl font-bold text-white border-b border-gray-700 pb-4 mb-6 flex items-center gap-2">
                    <svg class="w-6 h-6 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
                    Generated Result
                </h2>
                <div id="outputContainer" class="space-y-6">
                    <div class="text-center py-10 text-gray-500 italic">Ready to generate...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="copyNotification" class="fixed top-10 left-1/2 transform -translate-x-1/2 bg-emerald-500/90 backdrop-blur text-white py-3 px-6 rounded-full shadow-2xl pointer-events-none transition-all duration-500 opacity-0 -translate-y-20 flex items-center gap-3 z-50 font-medium">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        Copied to clipboard!
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const generateBtn = document.getElementById('generateBtn');
            const inputText = document.getElementById('inputText');
            const outputContainer = document.getElementById('outputContainer');
            const resultSection = document.getElementById('resultSection');
            const copyNotification = document.getElementById('copyNotification');

            // Initial Example Text
            inputText.value = `Question Title:
Harvard | ReferenceList | Book | MCQ | Q01

Scenario:
Select the correct reference format from the following:

Correct answer:
Okafor, C., Chen, R. and Russo, G. (2026) Constitutional Law and Politics. London: Harvard University Press. ← Correct

Other options:
Okafor, C., Chen, R. and Russo, G. Constitutional Law and Politics (2026). London.

Okafor, Chris (2026). Constitutional Law and Politics. Harvard University Press, London.

Okafor, C., Chen, R. and Russo, G. (2026). Constitutional Law and Politics. Harvard University Press: Oxford.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q02

Scenario:
Select the correct reference format from the following:

Correct answer:
Lee, M. and Müller, T. (2026) The Economics of Inequality. Cambridge, MA: Cambridge University Press. ← Correct

Other options:
Lee, Maria (2026). The Economics of Inequality. Cambridge University Press, Cambridge, MA.

Lee, M. and Müller, T. (2026). The Economics of Inequality. Cambridge University Press: London.

Lee, M. and Müller, T. The Economics of Inequality (2026). Cambridge, MA.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q03

Scenario:
Select the correct reference format from the following:

Correct answer:
Patel, K. (2024) Fundamentals of Nursing Practice. New Haven, CT: McGraw-Hill Education. ← Correct

Other options:
Patel, Kevin (2024). Fundamentals of Nursing Practice. McGraw-Hill Education, New Haven, CT.

Patel, K. Fundamentals of Nursing Practice (2024). New Haven, CT.

Patel, K. (2024). Fundamentals of Nursing Practice. McGraw-Hill Education: London.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q04

Scenario:
Select the correct reference format from the following:

Correct answer:
Kowalski, R. et al. (2025) Foundations of Machine Learning. Hoboken, NJ: Penguin. ← Correct

Other options:
Kowalski, R. et al. (2025). Foundations of Machine Learning. Penguin: London.

Kowalski, R. et al. Foundations of Machine Learning (2025). Hoboken, NJ.

Kowalski, Rachel (2025). Foundations of Machine Learning. Penguin, Hoboken, NJ.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q05

Scenario:
Select the correct reference format from the following:

Correct answer:
Tanaka, Y. (2025) Supply Chain Logistics. 3rd edn. Amsterdam: Oxford University Press. ← Correct

Other options:
Tanaka, Alex (2025). Supply Chain Logistics. Oxford University Press, Amsterdam.

Tanaka, Y. Supply Chain Logistics (2025). Amsterdam.

Tanaka, Y. (2025). Supply Chain Logistics. Oxford University Press: London.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q06

Scenario:
Select the correct reference format from the following:

Correct answer:
Rodriguez, M. (2027) The Architecture of Modern Data Systems. London: Routledge. ← Correct

Other options:
Rodriguez, M. The Architecture of Modern Data Systems (2027). London.

Rodriguez, M. (2027). The Architecture of Modern Data Systems. Routledge: Oxford.

Rodriguez, Maria (2027). The Architecture of Modern Data Systems. Routledge, London.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q07

Scenario:
Select the correct reference format from the following:

Correct answer:
Sokolov, I., Kim, S. and Meyer, W. (2027) Macroeconomics in the Global Economy. Berlin: Sage. ← Correct

Other options:
Sokolov, I., Kim, S. and Meyer, W. Macroeconomics in the Global Economy (2027). Berlin.

Sokolov, I., Kim, S. and Meyer, W. (2027). Macroeconomics in the Global Economy. Sage: London.

Sokolov, Ian (2027). Macroeconomics in the Global Economy. Sage, Berlin.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q08

Scenario:
Select the correct reference format from the following:

Correct answer:
Dubois, F. (2023) The History of Modern Europe. 4th edn. Princeton, NJ: Penguin. ← Correct

Other options:
Dubois, F. The History of Modern Europe (2023). Princeton, NJ.

Dubois, Fiona (2023). The History of Modern Europe. Penguin, Princeton, NJ.

Dubois, F. (2023). The History of Modern Europe. Penguin: London.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q09

Scenario:
Select the correct reference format from the following:

Correct answer:
Silva, J. (2027) Clinical Pharmacology and Therapeutics. London: Sage. ← Correct

Other options:
Silva, J. Clinical Pharmacology and Therapeutics (2027). London.

Silva, J. (2027). Clinical Pharmacology and Therapeutics. Sage: Oxford.

Silva, John (2027). Clinical Pharmacology and Therapeutics. Sage, London.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q10

Scenario:
Select the correct reference format from the following:

Correct answer:
Al-Farsi, H. (2024) Cognitive Psychology: Mind and Brain. Hoboken, NJ: Elsevier. ← Correct

Other options:
Al-Farsi, H. (2024). Cognitive Psychology: Mind and Brain. Elsevier: London.

Al-Farsi, Harry (2024). Cognitive Psychology: Mind and Brain. Elsevier, Hoboken, NJ.

Al-Farsi, H. Cognitive Psychology: Mind and Brain (2024). Hoboken, NJ.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q11

Scenario:
Select the correct reference format from the following:

Correct answer:
O'Connor, E., Jones, T. and Brown, P. (2027) Applied Data Science. London: McGraw-Hill Education. ← Correct

Other options:
O'Connor, E., Jones, T. and Brown, P. Applied Data Science (2027). London.

O'Connor, Emily (2027). Applied Data Science. McGraw-Hill Education, London.

O'Connor, E., Jones, T. and Brown, P. (2027). Applied Data Science. McGraw-Hill Education: Oxford.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q12

Scenario:
Select the correct reference format from the following:

Correct answer:
Yamamoto, K. (2026) Advanced Engineering Mathematics. Cambridge, MA: Harvard University Press. ← Correct

Other options:
Yamamoto, Kevin (2026). Advanced Engineering Mathematics. Harvard University Press, Cambridge, MA.

Yamamoto, K. (2026). Advanced Engineering Mathematics. Harvard University Press: London.

Yamamoto, K. Advanced Engineering Mathematics (2026). Cambridge, MA.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q13

Scenario:
Select the correct reference format from the following:

Correct answer:
Tremblay, L. (2026) Qualitative Inquiry and Research Design. Oxford: Palgrave Macmillan. ← Correct

Other options:
Tremblay, L. Qualitative Inquiry and Research Design (2026). Oxford.

Tremblay, L. (2026). Qualitative Inquiry and Research Design. Palgrave Macmillan: London.

Tremblay, Laura (2026). Qualitative Inquiry and Research Design. Palgrave Macmillan, Oxford.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q14

Scenario:
Select the correct reference format from the following:

Correct answer:
Anon. (2024) Artificial Intelligence: A Modern Approach. Berlin: Yale University Press. ← Correct

Other options:
an anonymous author (2024). Artificial Intelligence: A Modern Approach. Yale University Press, Berlin.

Anon. (2024). Artificial Intelligence: A Modern Approach. Yale University Press: London.

Anon. Artificial Intelligence: A Modern Approach (2024). Berlin.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q15

Scenario:
Select the correct reference format from the following:

Correct answer:
White, B. (2024) Organizational Behavior and Management. Cambridge: Princeton University Press. ← Correct

Other options:
White, B. Organizational Behavior and Management (2024). Cambridge.

White, B. (2024). Organizational Behavior and Management. Princeton University Press: London.

White, Brian (2024). Organizational Behavior and Management. Princeton University Press, Cambridge.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q16

Scenario:
Select the correct reference format from the following:

Correct answer:
Doe, A. et al. (2025) Introduction to Algorithms. London: Springer. ← Correct

Other options:
Doe, Alex (2025). Introduction to Algorithms. Springer, London.

Doe, A. et al. (2025). Introduction to Algorithms. Springer: Oxford.

Doe, A. et al. Introduction to Algorithms (2025). London.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q17

Scenario:
Select the correct reference format from the following:

Correct answer:
Smith, J. (2023) Strategic Brand Management. 3rd edn. Cambridge, MA: Penguin. ← Correct

Other options:
Smith, J. (2023). Strategic Brand Management. Penguin: London.

Smith, John (2023). Strategic Brand Management. Penguin, Cambridge, MA.

Smith, J. Strategic Brand Management (2023). Cambridge, MA.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q18

Scenario:
Select the correct reference format from the following:

Correct answer:
Gomez, N. et al. (2027) Contemporary Issues in Bioethics. New York, NY: Yale University Press. ← Correct

Other options:
Gomez, Nick (2027). Contemporary Issues in Bioethics. Yale University Press, New York, NY.

Gomez, N. et al. Contemporary Issues in Bioethics (2027). New York, NY.

Gomez, N. et al. (2027). Contemporary Issues in Bioethics. Yale University Press: London.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q19

Scenario:
Select the correct reference format from the following:

Correct answer:
Yamamoto, K. (2023) Global Perspectives on Climate Change Policy. Cambridge, MA: Wiley. ← Correct

Other options:
Yamamoto, Kevin (2023). Global Perspectives on Climate Change Policy. Wiley, Cambridge, MA.

Yamamoto, K. (2023). Global Perspectives on Climate Change Policy. Wiley: London.

Yamamoto, K. Global Perspectives on Climate Change Policy (2023). Cambridge, MA.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q20

Scenario:
Select the correct reference format from the following:

Correct answer:
Chen, R. and White, B. (2024) Principles of Neural Science. Oxford: Cambridge University Press. ← Correct

Other options:
Chen, R. and White, B. (2024). Principles of Neural Science. Cambridge University Press: London.

Chen, R. and White, B. Principles of Neural Science (2024). Oxford.

Chen, Rachel (2024). Principles of Neural Science. Cambridge University Press, Oxford.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q21

Scenario:
Select the correct reference format from the following:

Correct answer:
Lee, M. et al. (2027) Cognitive Psychology: Mind and Brain. Amsterdam: Sage. ← Correct

Other options:
Lee, Maria (2027). Cognitive Psychology: Mind and Brain. Sage, Amsterdam.

Lee, M. et al. Cognitive Psychology: Mind and Brain (2027). Amsterdam.

Lee, M. et al. (2027). Cognitive Psychology: Mind and Brain. Sage: London.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q22

Scenario:
Select the correct reference format from the following:

Correct answer:
Anon. (2024) Foundations of Machine Learning. London: Pearson. ← Correct

Other options:
Anon. Foundations of Machine Learning (2024). London.

an anonymous author (2024). Foundations of Machine Learning. Pearson, London.

Anon. (2024). Foundations of Machine Learning. Pearson: Oxford.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q23

Scenario:
Select the correct reference format from the following:

Correct answer:
Brown, P. (2023) Applied Data Science. Princeton, NJ: Yale University Press. ← Correct

Other options:
Brown, P. Applied Data Science (2023). Princeton, NJ.

Brown, P. (2023). Applied Data Science. Yale University Press: London.

Brown, Peter (2023). Applied Data Science. Yale University Press, Princeton, NJ.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q24

Scenario:
Select the correct reference format from the following:

Correct answer:
Hansen, O. (2023) The Architecture of Modern Data Systems. Princeton, NJ: Penguin. ← Correct

Other options:
Hansen, O. (2023). The Architecture of Modern Data Systems. Penguin: London.

Hansen, O. The Architecture of Modern Data Systems (2023). Princeton, NJ.

Hansen, Olivia (2023). The Architecture of Modern Data Systems. Penguin, Princeton, NJ.

Question Title:
Harvard | ReferenceList | Book | MCQ | Q25

Scenario:
Select the correct reference format from the following:

Correct answer:
Al-Farsi, H. (2024) Advanced Engineering Mathematics. Oxford: McGraw-Hill Education. ← Correct

Other options:
Al-Farsi, H. (2024). Advanced Engineering Mathematics. McGraw-Hill Education: London.

Al-Farsi, Harry (2024). Advanced Engineering Mathematics. McGraw-Hill Education, Oxford.

Al-Farsi, H. Advanced Engineering Mathematics (2024). Oxford.`;

            // Updated Keywords to include all variations provided
            const headingKeywords = [
                'Question Title:', 'Question title:',
                'Question:',
                'Scenario:',
                'Options:', 'Other options:', // New for MCQ
                'Correct Answer:', 'Correct answer:', // New for MCQ
                'Hint/Explanation:',
                'Fixed Parts:', 'Fixed parts:', 'Fixed text:',
                'Question Parts (Correct Drag Items):', 
                'Question Parts:', 'Question parts:', 'Question part:',
                'Confusing Words (Distractor Drag Items):', 
                'Confusing Words:', 'Confusing words:', 'Confusing parts:',
                'Hint:',
                'Full Correct Reference:'
            ];

            // Mapping keywords to logic types
            const sectionMap = {
                // Title
                'Question Title:': 'title',
                'Question title:': 'title',
                
                // Text Block (Question / Scenario)
                'Question:': 'question_text',
                'Scenario:': 'question_text',
                
                // Parts List
                'Question Parts': 'parts',
                'Question parts': 'parts',
                'Question part': 'parts',
                
                // Fixed Text List
                'Fixed Parts:': 'fixed',
                'Fixed parts:': 'fixed',
                'Fixed text:': 'fixed',
                'Fixed part:': 'fixed',
                
                // Distractors List
                'Confusing Words': 'distractors',
                'Confusing words': 'distractors',
                'Confusing parts': 'distractors',
                
                // MCQ List mappings (Options to be listed and copyable)
                'Correct Answer:': 'answer', // old dragged format
                'Correct answer:': 'options_list', // new MCQ format
                'Other options:': 'options_list', // new MCQ format
                'Options:': 'options_list',
                
                'Hint': 'hint'
            };

            // Icons for buttons
            const COPY_ICON = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>`;
            const CHECK_ICON = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>`;

            generateBtn.addEventListener('click', generateCopyableContent);

            function generateCopyableContent() {
                const text = inputText.value.trim();
                outputContainer.innerHTML = '';
                
                resultSection.classList.remove('opacity-50');
                resultSection.classList.add('opacity-100');

                if (!text) {
                    outputContainer.innerHTML = '<div class="text-center text-gray-500 py-8">Please enter text to generate content.</div>';
                    return;
                }

                const lines = text.split('\n');
                let blocks = [];
                let currentBlock = [];
                let insideExplicitBlock = false;

                lines.forEach(line => {
                    const trimmed = line.trim();
                    const isNumberedHeader = /^\d+\./.test(trimmed);
                    const isQuestionHeader = /^Question \d+/.test(trimmed); 
                    const isExplicitHeader = isNumberedHeader || isQuestionHeader;
                    
                    const isTitleHeader = trimmed.startsWith('Question Title:') || trimmed.startsWith('Question title:');
                    const isNewFormatStart = trimmed.startsWith('You are');
                    
                    if (isExplicitHeader) {
                        // Start of a new explicit block
                        if (currentBlock.length > 0) blocks.push(currentBlock);
                        currentBlock = [line];
                        insideExplicitBlock = true;
                    } else if (insideExplicitBlock) {
                        currentBlock.push(line);
                    } else {
                        // Implicit mode logic
                        if (isTitleHeader || isNewFormatStart) {
                             if (currentBlock.length > 0 && currentBlock.some(l => l.trim() !== '')) {
                                 blocks.push(currentBlock);
                                 currentBlock = [line];
                             } else {
                                 currentBlock.push(line);
                             }
                        } else {
                            currentBlock.push(line);
                        }
                    }
                });
                if (currentBlock.length > 0) blocks.push(currentBlock);

                let animationDelay = 0;

                blocks.forEach((blockLines) => {
                    const filteredLines = blockLines.filter(l => l.trim() !== '');
                    if (filteredLines.length === 0) return;

                    const questionContainer = document.createElement('div');
                    questionContainer.className = 'glass-panel p-6 rounded-2xl mb-8 fade-in-up border-l-4 border-indigo-500';
                    questionContainer.style.animationDelay = `${animationDelay}ms`;
                    animationDelay += 100;

                    outputContainer.appendChild(questionContainer);

                    // Check for Unlabeled MCQ Format (Old format fallback)
                    const hasHeaders = filteredLines.some(line => 
                        headingKeywords.some(k => line.trim().startsWith(k))
                    );

                    if (!hasHeaders && filteredLines.some(l => l.includes('← Correct') || l.includes('<- Correct'))) {
                        processMCQBlock(filteredLines, questionContainer);
                    } else {
                        processStandardBlock(blockLines, questionContainer);
                    }
                });
            }

            // --- UNLABELED MCQ PROCESSOR (Fallback) ---
            function processMCQBlock(lines, container) {
                const questionText = lines[0]; 
                const options = lines.slice(1);
                renderCopyableBlock(questionText, container, true);
                options.forEach(opt => {
                    const trimmed = opt.trim();
                    const isCorrect = trimmed.includes('← Correct') || trimmed.includes('<- Correct');
                    let cleanText = trimmed.replace('← Correct', '').replace('<- Correct', '').trim();
                    if (cleanText) {
                        renderCopyableLine(cleanText, container, true, isCorrect);
                    }
                });
            }

            // --- STANDARD PROCESSOR ---
            function processStandardBlock(blockLines, questionContainer) {
                let contentBuffer = [];
                let currentSection = 'none';

                blockLines.forEach(line => {
                    const trimmedLine = line.trim();
                    
                    const matchedHeader = headingKeywords.find(k => trimmedLine.startsWith(k));
                    
                    const isSeparator = /^-+$/.test(trimmedLine);
                    const isNumberedHeader = /^\d+\./.test(trimmedLine);
                    const isQuestionHeader = /^Question \d+/.test(trimmedLine); 

                    if (matchedHeader || isSeparator || isNumberedHeader || isQuestionHeader) {
                        // Flush previous content
                        if (contentBuffer.length > 0) {
                            processBuffer(contentBuffer, currentSection, questionContainer);
                            contentBuffer = [];
                        }

                        // Render Headers
                        if (isNumberedHeader || isQuestionHeader) {
                            const headerWrapper = document.createElement('div');
                            headerWrapper.className = 'flex justify-between items-center mb-6 mt-4 border-b border-gray-700/50 pb-4'; 
                            const heading = document.createElement('h3');
                            heading.className = 'text-xl sm:text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-white to-indigo-300 flex-grow pr-4';
                            heading.textContent = trimmedLine;
                            const copyBtn = createCopyButton(trimmedLine);
                            headerWrapper.appendChild(heading);
                            headerWrapper.appendChild(copyBtn);
                            questionContainer.appendChild(headerWrapper);
                            currentSection = 'none';
                        } else if (isSeparator) {
                            const hr = document.createElement('div');
                            hr.className = 'h-px bg-gradient-to-r from-transparent via-gray-600 to-transparent my-6';
                            questionContainer.appendChild(hr);
                            currentSection = 'none';
                        } else {
                            // Render Label (Scenario, Fixed text, etc)
                            const headingDiv = document.createElement('div');
                            headingDiv.className = 'text-xs font-bold text-indigo-400 uppercase tracking-widest mt-6 mb-2 pl-1';
                            headingDiv.textContent = matchedHeader; 
                            questionContainer.appendChild(headingDiv);
                            
                            // Determine Section Type from Map
                            let foundKey = Object.keys(sectionMap).find(key => matchedHeader.startsWith(key) || key.startsWith(matchedHeader));
                            if (!foundKey) {
                                foundKey = Object.keys(sectionMap).find(key => matchedHeader.toLowerCase().startsWith(key.toLowerCase()));
                            }

                            currentSection = foundKey ? sectionMap[foundKey] : 'none';

                            // Check for inline content
                            const contentAfter = trimmedLine.substring(matchedHeader.length).trim();
                            if (contentAfter) contentBuffer.push(contentAfter);
                        }
                    } else if (trimmedLine !== '') {
                        contentBuffer.push(trimmedLine);
                    }
                });

                if (contentBuffer.length > 0) {
                    processBuffer(contentBuffer, currentSection, questionContainer);
                }
            }

            function processBuffer(buffer, section, container) {
                let allowCopy = true;
                let joinChar = '\n';
                
                if (section === 'answer') allowCopy = false;
                if (section === 'question_text') joinChar = ' ';

                const joinedContent = buffer.join(joinChar);
                
                // Parts, Fixed, Distractors, MCQ Options = List Style (Line by line)
                // Title, Question, Scenario = Block Style (Single Block)
                if (section === 'parts' || section === 'distractors' || section === 'fixed' || section === 'options_list') {
                     buffer.forEach(line => {
                         if(line.trim()) {
                             // Detect 'correct' flags for MCQ lists natively, clean output
                             let isCorrect = line.includes('← Correct') || line.includes('<- Correct');
                             let cleanText = line.replace('← Correct', '').replace('<- Correct', '').trim();
                             renderCopyableLine(cleanText, container, allowCopy, isCorrect);
                         }
                     });
                } else {
                    renderCopyableBlock(joinedContent, container, allowCopy);
                }
            }

            function renderCopyableBlock(text, container, allowCopy) {
                const contentWrapper = document.createElement('div');
                contentWrapper.className = 'flex justify-between items-start bg-slate-900/40 p-4 rounded-xl my-3 border border-gray-700/50 hover:border-indigo-500/50 transition-colors group';
                
                const textSpan = document.createElement('span');
                textSpan.className = 'text-gray-200 whitespace-pre-wrap flex-grow font-normal leading-relaxed';
                textSpan.textContent = text;
                
                contentWrapper.appendChild(textSpan);
                if (allowCopy) {
                    const copyBtn = createCopyButton(text);
                    contentWrapper.appendChild(copyBtn);
                }
                container.appendChild(contentWrapper);
            }

            function renderCopyableLine(text, container, allowCopy, isCorrect = false) {
                const contentWrapper = document.createElement('div');
                
                let baseClasses = "flex justify-between items-center p-3 rounded-lg my-2 border transition-all hover:translate-x-1 duration-200";
                
                if (isCorrect) {
                    baseClasses += " bg-emerald-900/30 border-emerald-500 shadow-[0_0_15px_rgba(16,185,129,0.1)]";
                } else {
                    baseClasses += " bg-slate-800/40 border-gray-700/30";
                }
                
                contentWrapper.className = baseClasses;
                
                const textSpan = document.createElement('span');
                textSpan.className = isCorrect ? 'text-emerald-200 font-medium' : 'text-gray-300';
                textSpan.textContent = text;
                
                contentWrapper.appendChild(textSpan);

                if (allowCopy) {
                    const copyBtn = createCopyButton(text);
                    contentWrapper.appendChild(copyBtn);
                }

                container.appendChild(contentWrapper);
            }

            function createCopyButton(text) {
                const btn = document.createElement('button');
                btn.className = 'flex items-center justify-center ml-4 p-2 rounded-lg bg-slate-700 hover:bg-indigo-600 text-gray-400 hover:text-white transition-all duration-300 shadow-sm hover:shadow-lg hover:scale-110 flex-shrink-0';
                btn.title = "Copy to clipboard";
                btn.innerHTML = COPY_ICON;

                btn.onclick = function() {
                    copyToClipboard(text);
                    btn.innerHTML = CHECK_ICON;
                    btn.classList.remove('bg-slate-700', 'hover:bg-indigo-600');
                    btn.classList.add('bg-emerald-500', 'text-white');
                    setTimeout(() => {
                        btn.innerHTML = COPY_ICON;
                        btn.classList.remove('bg-emerald-500', 'text-white');
                        btn.classList.add('bg-slate-700');
                    }, 2000);
                };
                return btn;
            }

            function copyToClipboard(text) {
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = text;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                try {
                    document.execCommand('copy');
                    showNotification();
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                } finally {
                    document.body.removeChild(tempTextArea);
                }
            }

            function showNotification() {
                copyNotification.classList.remove('opacity-0', '-translate-y-20');
                copyNotification.classList.add('opacity-100', 'translate-y-0');
                setTimeout(() => {
                    copyNotification.classList.remove('opacity-100', 'translate-y-0');
                    copyNotification.classList.add('opacity-0', '-translate-y-20');
                }, 2000);
            }
            
            generateCopyableContent();
        });
    </script>
</body>
</html>
